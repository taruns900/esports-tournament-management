<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esports Organizer Registration System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gaming: {
                            primary: '#6366f1',
                            secondary: '#8b5cf6',
                            accent: '#06b6d4',
                            dark: '#1f2937',
                            darker: '#111827'
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gradient-to-br from-gaming-darker via-gaming-dark to-gray-900 text-white min-h-screen">
    <!-- Navigation -->
    <nav class="bg-black/50 backdrop-blur-md border-b border-gray-800 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <i class="fas fa-trophy text-gaming-accent text-2xl mr-3"></i>
                        <h1
                            class="text-xl font-bold bg-gradient-to-r from-gaming-primary to-gaming-accent bg-clip-text text-transparent">
                            EsportsHub
                        </h1>
                    </div>
                </div>

                <div class="hidden md:flex items-center space-x-8">
                    <button onclick="window.location.href='/tournaments.html'"
                        class="nav-btn hover:text-gaming-accent transition-colors">
                        <i class="fas fa-gamepad mr-2"></i>Tournaments
                    </button>
                    <button onclick="showComingSoon()"
                        class="nav-btn hover:text-gaming-accent transition-colors opacity-60 cursor-not-allowed">
                        <i class="fas fa-medal mr-2"></i>Leaderboards
                    </button>
                    <button onclick="showComingSoon()"
                        class="nav-btn hover:text-gaming-accent transition-colors opacity-60 cursor-not-allowed">
                        <i class="fas fa-broadcast-tower mr-2"></i>Live Matches
                    </button>
                </div>

                <!-- Auth Buttons (shown when not logged in) -->
                <div id="auth-buttons" class="flex items-center space-x-4">
                    <button onclick="showSection('organizer-login')"
                        class="bg-gaming-primary hover:bg-gaming-secondary px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-user-tie mr-2"></i>Organizer Login
                    </button>
                    <button onclick="showSection('player-login')"
                        class="bg-gaming-accent hover:bg-cyan-600 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sign-in-alt mr-2"></i>Player Login
                    </button>
                </div>

                <!-- Logout Button (shown when logged in) -->
                <div id="logout-button" class="hidden items-center space-x-4">
                    <span id="user-name-display" class="text-gray-300 mr-2"></span>
                    <button onclick="logout()"
                        class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="min-h-screen">
        <!-- Home/Dashboard Section -->
        <section id="home" class="section active">
            <!-- Hero Section -->
            <div class="relative bg-gradient-to-r from-gaming-primary/20 to-gaming-secondary/20 py-20">
                <div class="max-w-7xl mx-auto px-4 text-center">
                    Esports Organizer Hub
                    </h2>
                    <p class="text-xl text-gray-400 mb-8 max-w-2xl mx-auto leading-relaxed">
                        The ultimate platform for esports event organizers. Register, manage your profile,
                        and join the community of professional tournament organizers.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button onclick="browseTournaments()"
                            class="bg-gaming-primary hover:bg-gaming-secondary px-8 py-4 rounded-lg text-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg">
                            <i class="fas fa-search mr-2"></i>Browse Tournament
                        </button>
                        <button onclick="createTournament()"
                            class="bg-gaming-primary hover:bg-gaming-secondary px-8 py-4 text-lg font-semibold rounded-xl transition-all transform hover:scale-105">
                            <i class="fas fa-plus-circle mr-2"></i>Create Tournament
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Section -->
            <div class="py-16 bg-black/30">
                <div class="max-w-7xl mx-auto px-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-gaming-accent mb-2" id="stat-organizers">0</div>
                            <div class="text-gray-300">Registered Organizers</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-gaming-primary mb-2" id="stat-verified">0</div>
                            <div class="text-gray-300">Registered Players</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-green-400 mb-2" id="stat-active">0</div>
                            <div class="text-gray-300">Active Tournaments</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Featured Games -->
            <div class="py-16">
                <div class="max-w-7xl mx-auto px-4">
                    <h2 class="text-3xl font-bold text-center mb-12">Supported Games</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="bg-gray-800/50 rounded-xl p-8 text-center hover:bg-gray-800/70 transition-colors">
                            <i class="fas fa-mobile-alt text-5xl text-gaming-accent mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">PUBG Mobile</h3>
                            <p class="text-gray-300">Battle Royale ‚Ä¢ Solo, Duo, Squad</p>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-8 text-center hover:bg-gray-800/70 transition-colors">
                            <i class="fas fa-desktop text-5xl text-gaming-primary mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">Valorant PC</h3>
                            <p class="text-gray-300">Tactical FPS ‚Ä¢ Team-based</p>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-8 text-center hover:bg-gray-800/70 transition-colors">
                            <i class="fas fa-crosshairs text-5xl text-gaming-secondary mb-4"></i>
                            <h3 class="text-xl font-bold mb-2">Call of Duty</h3>
                            <p class="text-gray-300">FPS ‚Ä¢ Multiple Modes</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Tournaments Section -->
            <div class="py-16 bg-black/20">
                <div class="max-w-7xl mx-auto px-4">
                    <div class="flex justify-between items-center mb-8">
                        <h2 class="text-3xl font-bold">üèÜ Active Tournaments</h2>
                        <button onclick="window.location.href='/tournaments.html'"
                            class="text-gaming-accent hover:text-gaming-primary transition-colors">
                            View All <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                    <div id="tournaments-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Tournaments will be loaded here -->
                        <div class="text-center col-span-full py-8 text-gray-400">
                            <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
                            <p>Loading tournaments...</p>
                        </div>
                    </div>
                    <!-- Featured Tournament (dynamic) -->
                    <div id="featured-tournament" class="mt-12 hidden bg-gray-800/50 rounded-xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold flex items-center"><i class="fas fa-star text-yellow-400 mr-2"></i>Featured Tournament</h3>
                            <button id="featured-view-btn" class="bg-gaming-primary hover:bg-gaming-secondary px-4 py-2 rounded-lg text-sm font-semibold">View & Join</button>
                        </div>
                        <div id="featured-content" class="text-sm text-gray-300"></div>
                    </div>
                    <!-- Organizer Wallet Widget -->
                    <div id="organizer-wallet" class="mt-16 hidden">
                        <h3 class="text-2xl font-bold mb-6 flex items-center"><i class="fas fa-wallet text-gaming-accent mr-3"></i>Your Wallet</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="bg-gray-800/60 rounded-xl p-6">
                                <div class="text-gray-400 text-sm">Available Balance</div>
                                <div class="text-3xl font-bold mt-2" id="org-wallet-balance">‚Çπ0</div>
                            </div>
                            <div class="bg-gray-800/60 rounded-xl p-6">
                                <div class="text-gray-400 text-sm">Locked (Prize Pools)</div>
                                <div class="text-3xl font-bold mt-2" id="org-wallet-locked">‚Çπ0</div>
                            </div>
                            <div class="bg-gray-800/60 rounded-xl p-6">
                                <div class="text-gray-400 text-sm">Total Balance</div>
                                <div class="text-3xl font-bold mt-2" id="org-wallet-total">‚Çπ0</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="bg-gray-800/50 rounded-xl p-6">
                                <h4 class="font-semibold mb-4">Deposit Funds</h4>
                                <form id="org-deposit-form" class="space-y-4" onsubmit="handleOrganizerDeposit(event)">
                                    <input type="number" min="1" id="org-deposit-amount" placeholder="Amount" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none" required />
                                    <button type="submit" class="w-full bg-gaming-accent hover:bg-cyan-600 py-2 rounded-lg font-semibold transition-colors">Deposit</button>
                                </form>
                            </div>
                            <div class="bg-gray-800/50 rounded-xl p-6">
                                <h4 class="font-semibold mb-4">Withdraw Funds</h4>
                                <form id="org-withdraw-form" class="space-y-4" onsubmit="handleOrganizerWithdraw(event)">
                                    <input type="number" min="1" id="org-withdraw-amount" placeholder="Amount" class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none" required />
                                    <button type="submit" class="w-full bg-gaming-primary hover:bg-gaming-secondary py-2 rounded-lg font-semibold transition-colors">Withdraw</button>
                                </form>
                            </div>
                        </div>
                        <div class="bg-gray-800/50 rounded-xl p-6 mt-8">
                            <h4 class="font-semibold mb-4">Recent Transactions</h4>
                            <div id="org-transactions" class="space-y-3 text-sm"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Coming Soon Section -->
        <section id="coming-soon" class="section hidden">
            <div class="max-w-4xl mx-auto px-4 py-16 text-center">
                <div class="bg-gray-800/50 rounded-xl p-12">
                    <i class="fas fa-rocket text-6xl text-gaming-accent mb-6"></i>
                    <h2 class="text-4xl font-bold mb-4">Coming Soon!</h2>
                    <p class="text-xl text-gray-300 mb-8">
                        We're working hard to bring you advanced organizer management features.
                        These features will be available soon.
                    </p>
                    <div class="space-y-4 text-gray-400 mb-8">
                        <p><i class="fas fa-calendar mr-3 text-gaming-accent"></i>Event Planning & Scheduling</p>
                        <p><i class="fas fa-users mr-3 text-gaming-primary"></i>Organizer Network & Collaboration</p>
                        <p><i class="fas fa-chart-line mr-3 text-gaming-secondary"></i>Analytics & Performance Tracking
                        </p>
                        <p><i class="fas fa-cog mr-3 text-cyan-400"></i>Advanced Profile Management</p>
                    </div>
                    <button onclick="showSection('home')"
                        class="bg-gaming-primary hover:bg-gaming-secondary px-8 py-3 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-home mr-2"></i>Back to Home
                    </button>
                </div>
            </div>
        </section>

        <!-- Player Login/Registration - Coming Soon -->
        <section id="player-login" class="section hidden">
            <div class="max-w-md mx-auto px-4 py-16">
                <div class="bg-gray-800/50 rounded-xl p-8">
                    <h2 class="text-2xl font-bold text-center mb-6">Player Portal</h2>
                    <div id="player-auth-tabs" class="flex mb-6 border-b border-gray-600">
                        <button onclick="showPlayerTab('login')"
                            class="tab-btn flex-1 py-2 text-center border-b-2 border-gaming-accent">Login</button>
                        <button onclick="showPlayerTab('register')"
                            class="tab-btn flex-1 py-2 text-center">Register</button>
                    </div>

                    <!-- Player Login Form -->
                    <div id="player-login-form" class="auth-form active">
                        <form onsubmit="playerLogin(event)">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Email</label>
                                <input type="email" id="player-email"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none"
                                    required>
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Player ID</label>
                                <input type="text" id="player-id"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none"
                                    required>
                            </div>
                            <button type="submit"
                                class="w-full bg-gaming-accent hover:bg-cyan-600 py-2 rounded-lg font-semibold transition-colors">
                                Login
                            </button>
                        </form>
                    </div>

                    <!-- Player Registration Form -->
                    <div id="player-register-form" class="auth-form hidden">
                        <form onsubmit="playerRegister(event)">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">First Name</label>
                                    <input type="text" id="reg-first-name"
                                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none"
                                        minlength="2" maxlength="50" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Last Name</label>
                                    <input type="text" id="reg-last-name"
                                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none"
                                        minlength="2" maxlength="50" required>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Email</label>
                                    <input type="email" id="reg-email"
                                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none"
                                        required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Phone</label>
                                    <input type="tel" id="reg-phone"
                                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none"
                                        placeholder="e.g., +919876543210" required>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Age</label>
                                    <input type="number" id="reg-age" min="13" max="99"
                                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none"
                                        required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Country</label>
                                    <select id="reg-country"
                                        class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-accent focus:outline-none"
                                        required>
                                        <option value="">Select Country</option>
                                        <option value="india">India</option>
                                        <option value="usa">United States</option>
                                        <option value="uk">United Kingdom</option>
                                        <option value="canada">Canada</option>
                                        <option value="australia">Australia</option>
                                        <option value="pakistan">Pakistan</option>
                                        <option value="bangladesh">Bangladesh</option>
                                        <option value="srilanka">Sri Lanka</option>
                                        <option value="nepal">Nepal</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Gender</label>
                                <div class="flex items-center gap-6">
                                    <label class="inline-flex items-center gap-2">
                                        <input type="radio" name="reg-gender" id="reg-gender-male" value="male" required>
                                        <span>Male</span>
                                    </label>
                                    <label class="inline-flex items-center gap-2">
                                        <input type="radio" name="reg-gender" id="reg-gender-female" value="female">
                                        <span>Female</span>
                                    </label>
                                    <label class="inline-flex items-center gap-2">
                                        <input type="radio" name="reg-gender" id="reg-gender-other" value="other">
                                        <span>Other</span>
                                    </label>
                                </div>
                            </div>
                            <button type="submit"
                                class="w-full bg-gaming-accent hover:bg-cyan-600 py-2 rounded-lg font-semibold transition-colors">
                                Register
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <!-- Organizer Login/Registration -->
        <section id="organizer-login" class="section hidden">
            <div class="max-w-md mx-auto px-4 py-16">
                <div class="bg-gray-800/50 rounded-xl p-8">
                    <h2 class="text-2xl font-bold text-center mb-6">Organizer Portal</h2>
                    <div id="organizer-auth-tabs" class="flex mb-6 border-b border-gray-600">
                        <button onclick="showOrganizerTab('login')"
                            class="tab-btn flex-1 py-2 text-center border-b-2 border-gaming-primary">Login</button>
                        <button onclick="showOrganizerTab('register')"
                            class="tab-btn flex-1 py-2 text-center">Register</button>
                    </div>

                    <!-- Organizer Login Form -->
                    <div id="organizer-login-form" class="auth-form active">
                        <form onsubmit="organizerLogin(event)">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Email</label>
                                <input type="email" id="org-email"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-primary focus:outline-none"
                                    required>
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Organizer ID</label>
                                <input type="text" id="org-id"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-primary focus:outline-none"
                                    required>
                            </div>
                            <div class="space-y-3">
                                <button type="submit"
                                    class="w-full bg-gaming-primary hover:bg-gaming-secondary py-2 rounded-lg font-semibold transition-colors">
                                    Login
                                </button>
                                <button type="button" onclick="showSection('home')"
                                    class="w-full bg-gray-600 hover:bg-gray-700 py-2 rounded-lg font-semibold transition-colors">
                                    <i class="fas fa-home mr-2"></i>Back to Home
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Organizer Registration Form -->
                    <div id="organizer-register-form" class="auth-form hidden">
                        <form onsubmit="organizerRegister(event)">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Full Name</label>
                                <input type="text" id="org-reg-name"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-primary focus:outline-none"
                                    required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Email</label>
                                <input type="email" id="org-reg-email"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-primary focus:outline-none"
                                    required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Phone Number</label>
                                <input type="tel" id="org-reg-phone"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-primary focus:outline-none"
                                    placeholder="e.g., +1234567890 or 9876543210" required>
                                <p class="text-xs text-gray-400 mt-1">Enter at least 8 digits (with or without country
                                    code)</p>
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Past Event Experience</label>
                                <textarea id="org-reg-experience" rows="4"
                                    class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:border-gaming-primary focus:outline-none"
                                    placeholder="Describe your previous experience organizing tournaments or events..."
                                    minlength="10" maxlength="1000" required></textarea>
                                <p class="text-xs text-gray-400 mt-1">Minimum 10 characters required</p>
                            </div>
                            <div class="space-y-3">
                                <button type="submit"
                                    class="w-full bg-gaming-primary hover:bg-gaming-secondary py-2 rounded-lg font-semibold transition-colors">
                                    Create Account
                                </button>
                                <button type="button" onclick="showSection('home')"
                                    class="w-full bg-gray-600 hover:bg-gray-700 py-2 rounded-lg font-semibold transition-colors">
                                    <i class="fas fa-home mr-2"></i>Back to Home
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>


    </main>

    <!-- Footer -->
    <footer class="bg-black/50 border-t border-gray-800 py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-400">
            <p>&copy; 2025 EsportsHub. Secure tournament management platform.</p>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div id="loading" class="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="text-center">
            <i class="fas fa-spinner fa-spin text-4xl text-gaming-accent mb-4"></i>
            <p class="text-lg">Loading...</p>
        </div>
    </div>

    <!-- Notification System -->
    <div id="notifications" class="fixed top-20 right-4 z-40 space-y-2">
        <!-- Notifications will appear here -->
    </div>

    <script>
        // Function to create tournament
        function createTournament() {
            console.log('Create tournament function called');

            // Check if organizer is logged in
            const userData = localStorage.getItem('esports_user');
            const userType = localStorage.getItem('esports_user_type');

            console.log('User data:', userData);
            console.log('User type:', userType);

            if (!userData || userType !== 'organizer') {
                console.log('Not authenticated - redirecting to login');
                if (typeof showNotification === 'function') {
                    showNotification('Please login as an organizer to create tournaments', 'error');
                } else {
                    alert('Please login as an organizer to create tournaments');
                }
                if (typeof showSection === 'function') {
                    showSection('organizer-login');
                }
                return false;
            }

            console.log('User authenticated - navigating to create tournament page');
            // Direct navigation to the create-tournament page
            window.location.href = '/create-tournament';
            return true;
        }

        // Function to browse tournaments
        function browseTournaments() {
            // Check if user is logged in
            const userData = localStorage.getItem('esports_user');
            const userType = localStorage.getItem('esports_user_type');

            if (userData && userType === 'player') {
                // Redirect to player dashboard
                window.location.href = '/player-dashboard.html';
            } else if (userData && userType === 'organizer') {
                // Redirect to tournaments page
                window.location.href = '/tournaments.html';
            } else {
                // Not logged in - redirect to home where login sections exist
                if (typeof showNotification === 'function') {
                    showNotification('Please login to browse tournaments', 'warning');
                }
                window.location.href = '/';
            }
        }

        // Organizer Wallet Logic
        async function refreshOrganizerWallet() {
            const session = getUserSession();
            if (!session || session.type !== 'organizer') return;
            try {
                const res = await fetch(`tables/organizers/${session.user.id}`);
                const json = await res.json();
                if (json.success) {
                    const org = json.data;
                    document.getElementById('org-wallet-balance').textContent = '‚Çπ' + (org.walletBalance || 0);
                    document.getElementById('org-wallet-locked').textContent = '‚Çπ' + (org.lockedPrizePool || 0);
                    document.getElementById('org-wallet-total').textContent = '‚Çπ' + ((org.walletBalance || 0) + (org.lockedPrizePool || 0));
                }
            } catch (e) { console.error('Wallet refresh error', e); }
        }

        async function loadOrganizerTransactions() {
            const session = getUserSession();
            if (!session || session.type !== 'organizer') return;
            try {
                const res = await fetch(`/wallet/transactions?userId=${session.user.id}&userType=organizer&limit=20`);
                const json = await res.json();
                const container = document.getElementById('org-transactions');
                if (!json.success || json.data.length === 0) {
                    container.innerHTML = '<p class="text-gray-400">No transactions yet.</p>';
                    return;
                }
                container.innerHTML = json.data.map(tx => `<div class="flex justify-between items-center bg-gray-700/40 px-3 py-2 rounded">
                    <span class="capitalize">${tx.type.replace('-', ' ')}</span>
                    <span class="font-mono">‚Çπ${tx.amount}</span>
                    <span class="text-xs text-gray-400">${new Date(tx.createdAt).toLocaleDateString()}</span>
                </div>`).join('');
            } catch (e) { console.error('Transactions load error', e); }
        }

        async function handleOrganizerDeposit(e) {
            e.preventDefault();
            const session = getUserSession();
            if (!session || session.type !== 'organizer') return;
            const amount = parseInt(document.getElementById('org-deposit-amount').value, 10);
            if (isNaN(amount) || amount <= 0) return;
            try {
                const res = await fetch('/wallet/deposit', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId: session.user.id, userType: 'organizer', amount }) });
                const json = await res.json();
                if (json.success) {
                    showNotification('Deposit successful', 'success');
                    document.getElementById('org-deposit-form').reset();
                    refreshOrganizerWallet();
                    loadOrganizerTransactions();
                } else showNotification(json.message || 'Deposit failed', 'error');
            } catch (err) { console.error(err); showNotification('Deposit error', 'error'); }
        }

        async function handleOrganizerWithdraw(e) {
            e.preventDefault();
            const session = getUserSession();
            if (!session || session.type !== 'organizer') return;
            const amount = parseInt(document.getElementById('org-withdraw-amount').value, 10);
            if (isNaN(amount) || amount <= 0) return;
            try {
                const res = await fetch('/wallet/withdraw', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ userId: session.user.id, userType: 'organizer', amount }) });
                const json = await res.json();
                if (json.success) {
                    showNotification('Withdrawal successful', 'success');
                    document.getElementById('org-withdraw-form').reset();
                    refreshOrganizerWallet();
                    loadOrganizerTransactions();
                } else showNotification(json.message || 'Withdrawal failed', 'error');
            } catch (err) { console.error(err); showNotification('Withdrawal error', 'error'); }
        }

        // On load decide whether to show organizer wallet widget
        document.addEventListener('DOMContentLoaded', () => {
            const session = getUserSession();
            if (session && session.type === 'organizer') {
                const widget = document.getElementById('organizer-wallet');
                if (widget) {
                    widget.classList.remove('hidden');
                    refreshOrganizerWallet();
                    loadOrganizerTransactions();
                }
            }
            // Load featured tournament
            loadFeaturedTournament();
        });

        async function loadFeaturedTournament(){
            try {
                const res = await fetch('/tables/tournaments?status=registration-open&limit=10');
                const json = await res.json();
                if (!json.success || !json.data.length) return;
                const now = Date.now();
                const TWO_HOURS = 2*60*60*1000;
                const candidates = json.data.filter(t => {
                    if (!t.startDate) return true;
                    const startMs = new Date(t.startDate).getTime();
                    return now - startMs < TWO_HOURS;
                });
                if (!candidates.length) return;
                // Pick the most recently created tournament
                candidates.sort((a,b)=> new Date(b.createdAt) - new Date(a.createdAt));
                const ft = candidates[0];
                const box = document.getElementById('featured-tournament');
                const content = document.getElementById('featured-content');
                const btn = document.getElementById('featured-view-btn');
                content.innerHTML = `
                    <div class='grid md:grid-cols-3 gap-4'>
                        <div><span class='text-gray-400'>Name:</span> <span class='font-semibold'>${ft.tournamentName}</span></div>
                        <div><span class='text-gray-400'>Game:</span> <span class='font-semibold capitalize'>${ft.game}</span></div>
                        <div><span class='text-gray-400'>Mode:</span> <span class='font-semibold'>${ft.mode.toUpperCase()}</span></div>
                        <div><span class='text-gray-400'>Prize Pool:</span> <span class='font-semibold text-yellow-400'>‚Çπ${ft.prizePool.toLocaleString()}</span></div>
                        <div><span class='text-gray-400'>Entry Fee:</span> <span class='font-semibold'>${ft.hasEntryFee? '‚Çπ'+ft.entryFee : 'FREE'}</span></div>
                        <div><span class='text-gray-400'>Slots:</span> <span class='font-semibold'>${ft.currentParticipants}/${ft.maxTeams}</span></div>
                    </div>`;
                btn.onclick = () => { window.location.href = `/join-tournament.html?id=${encodeURIComponent(ft.id)}`; };
                box.classList.remove('hidden');
            } catch(e){ console.error('Featured tournament load error', e); }
        }
    </script>

        <script src="js/app.js"></script>
        <script src="js/auth.js"></script>
        <script src="js/utilities.js"></script>
        <script>
            // Ensure cards on the home page open the short join page for players
            window.viewTournamentDetails = function(tournamentId){
                try{
                    const userType = localStorage.getItem('esports_user_type');
                    if (userType !== 'player') {
                        if (typeof showNotification === 'function') {
                            showNotification('Please login as a player to join tournaments', 'warning');
                        }
                        return;
                    }
                    window.location.href = '/join-tournament.html?id=' + encodeURIComponent(tournamentId);
                } catch(e){
                    console.error('viewTournamentDetails override error:', e);
                    if (typeof showNotification === 'function') {
                        showNotification('Unable to open tournament page', 'error');
                    }
                }
            };
        </script>
</body>

</html>